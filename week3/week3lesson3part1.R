#install packages for cleaning
install.packages("janitor")
install.packages("skimr")
library(skimr)
library(janitor)
#check that they are installed and loaded
library()

#import data for manipulation - done in prev lesson, check that we still have it
head(bookings_df)
str(bookings_df)
glimpse(bookings_df)

#trying summarizing from skimr package
skim_without_charts(bookings_df)

# select only requested columns
trimmed_df <- bookings_df %>%
  select("hotel", "is_canceled", "lead_time")
head(trimmed_df)

# rename as requested
trimmed_df <- rename(trimmed_df, "hotel_type" = "hotel")
head(trimmed_df)
# the function rename doesn't modify input - it returns new dataframe, hence reassignment)

#combine arrival month and year into same column
arrival_df <- bookings_df %>%
  select(arrival_date_year, arrival_date_month) %>%
  unite(arrival_month_year, c("arrival_date_month", "arrival_date_year"), sep = " ")
head(arrival_df)

#add "guests" column that sums adult, children and babies for each reservation
guests_df <- bookings_df %>%
  mutate(guests = adults + babies + children)
str(guests_df)

#calculate number of canceled reservations and average lead time
summary_df <- bookings_df %>%
  summarise(number_canceled = sum(is_canceled), average_lead_time = mean(lead_time))
summary_df

# OUTPUT (only some)
#str(bookings_df)
#spc_tbl_ [119,390 × 32] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
#$ hotel                         : chr [1:119390] "Resort Hotel" "Resort Hotel" "Resort Hotel" "Resort Hotel" ...
#$ is_canceled                   : num [1:119390] 0 0 0 0 0 0 0 0 1 1 ...
#$ lead_time                     : num [1:119390] 342 737 7 13 14 14 0 9 85 75 ...
#$ arrival_date_year             : num [1:119390] 2015 2015 2015 2015 2015 ...
#$ arrival_date_month            : chr [1:119390] "July" "July" "July" "July" ...
#$ arrival_date_week_number      : num [1:119390] 27 27 27 27 27 27 27 27 27 27 ...
#$ arrival_date_day_of_month     : num [1:119390] 1 1 1 1 1 1 1 1 1 1 ...
#$ stays_in_weekend_nights       : num [1:119390] 0 0 0 0 0 0 0 0 0 0 ...
#$ stays_in_week_nights          : num [1:119390] 0 0 1 1 2 2 2 2 3 3 ...
#$ adults                        : num [1:119390] 2 2 1 1 2 2 2 2 2 2 ...
#$ children                      : num [1:119390] 0 0 0 0 0 0 0 0 0 0 ...
#$ babies                        : num [1:119390] 0 0 0 0 0 0 0 0 0 0 ...
#$ meal                          : chr [1:119390] "BB" "BB" "BB" "BB" ...
#$ country                       : chr [1:119390] "PRT" "PRT" "GBR" "GBR" ...
#$ market_segment                : chr [1:119390] "Direct" "Direct" "Direct" "Corporate" ...
#$ distribution_channel          : chr [1:119390] "Direct" "Direct" "Direct" "Corporate" ...
#$ is_repeated_guest             : num [1:119390] 0 0 0 0 0 0 0 0 0 0 ...
#$ previous_cancellations        : num [1:119390] 0 0 0 0 0 0 0 0 0 0 ...
#$ previous_bookings_not_canceled: num [1:119390] 0 0 0 0 0 0 0 0 0 0 ...
#$ reserved_room_type            : chr [1:119390] "C" "C" "A" "A" ...
#$ assigned_room_type            : chr [1:119390] "C" "C" "C" "A" ...
#$ booking_changes               : num [1:119390] 3 4 0 0 0 0 0 0 0 0 ...
#$ deposit_type                  : chr [1:119390] "No Deposit" "No Deposit" "No Deposit" "No Deposit" ...
#$ agent                         : chr [1:119390] "NULL" "NULL" "NULL" "304" ...
#$ company                       : chr [1:119390] "NULL" "NULL" "NULL" "NULL" ...
#$ days_in_waiting_list          : num [1:119390] 0 0 0 0 0 0 0 0 0 0 ...
#$ customer_type                 : chr [1:119390] "Transient" "Transient" "Transient" "Transient" ...
#$ adr                           : num [1:119390] 0 0 75 75 98 ...
#$ required_car_parking_spaces   : num [1:119390] 0 0 0 0 0 0 0 0 0 0 ...
#$ total_of_special_requests     : num [1:119390] 0 0 0 0 1 1 0 1 1 0 ...
#$ reservation_status            : chr [1:119390] "Check-Out" "Check-Out" "Check-Out" "Check-Out" ...
#$ reservation_status_date       : Date[1:119390], format: "2015-07-01" "2015-07-01" "2015-07-02" ...
#- attr(*, "spec")=
#  .. cols(
#    ..   hotel = col_character(),
#    ..   is_canceled = col_double(),
#    ..   lead_time = col_double(),
#    ..   arrival_date_year = col_double(),
#    ..   arrival_date_month = col_character(),
#    ..   arrival_date_week_number = col_double(),
#    ..   arrival_date_day_of_month = col_double(),
#    ..   stays_in_weekend_nights = col_double(),
#    ..   stays_in_week_nights = col_double(),
#    ..   adults = col_double(),
#    ..   children = col_double(),
#    ..   babies = col_double(),
#    ..   meal = col_character(),
#    ..   country = col_character(),
#    ..   market_segment = col_character(),
#    ..   distribution_channel = col_character(),
#    ..   is_repeated_guest = col_double(),
#    ..   previous_cancellations = col_double(),
#    ..   previous_bookings_not_canceled = col_double(),
#    ..   reserved_room_type = col_character(),
#    ..   assigned_room_type = col_character(),
#    ..   booking_changes = col_double(),
#    ..   deposit_type = col_character(),
#    ..   agent = col_character(),
#    ..   company = col_character(),
#    ..   days_in_waiting_list = col_double(),
#    ..   customer_type = col_character(),
#    ..   adr = col_double(),
#    ..   required_car_parking_spaces = col_double(),
#    ..   total_of_special_requests = col_double(),
#    ..   reservation_status = col_character(),
#    ..   reservation_status_date = col_date(format = "")
#    .. )
#- attr(*, "problems")=<externalptr> 
#  > glimse(bookings_df)
#Error in glimse(bookings_df) : could not find function "glimse"
#> glimpse(bookings_df)
#Rows: 119,390
#Columns: 32
#$ hotel                          <chr> "Resort Hotel", "Resort Hotel", "Resort Hotel", "Resort Hotel",…
#$ is_canceled                    <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
#$ lead_time                      <dbl> 342, 737, 7, 13, 14, 14, 0, 9, 85, 75, 23, 35, 68, 18, 37, 68, …
#$ arrival_date_year              <dbl> 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 201…
#$ arrival_date_month             <chr> "July", "July", "July", "July", "July", "July", "July", "July",…
#$ arrival_date_week_number       <dbl> 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27,…
#$ arrival_date_day_of_month      <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
#$ stays_in_weekend_nights        <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, …
#$ stays_in_week_nights           <dbl> 0, 0, 1, 1, 2, 2, 2, 2, 3, 3, 4, 4, 4, 4, 4, 4, 4, 1, 1, 4, 4, …
#$ adults                         <dbl> 2, 2, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, …
#$ children                       <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, …
#$ babies                         <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
#$ meal                           <chr> "BB", "BB", "BB", "BB", "BB", "BB", "BB", "FB", "BB", "HB", "BB…
#$ country                        <chr> "PRT", "PRT", "GBR", "GBR", "GBR", "GBR", "PRT", "PRT", "PRT", …
#$ market_segment                 <chr> "Direct", "Direct", "Direct", "Corporate", "Online TA", "Online…
#$ distribution_channel           <chr> "Direct", "Direct", "Direct", "Corporate", "TA/TO", "TA/TO", "D…
#$ is_repeated_guest              <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
#$ previous_cancellations         <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
#$ previous_bookings_not_canceled <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
#$ reserved_room_type             <chr> "C", "C", "A", "A", "A", "A", "C", "C", "A", "D", "E", "D", "D"…
#$ assigned_room_type             <chr> "C", "C", "C", "A", "A", "A", "C", "C", "A", "D", "E", "D", "E"…
#$ booking_changes                <dbl> 3, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, …
#$ deposit_type                   <chr> "No Deposit", "No Deposit", "No Deposit", "No Deposit", "No Dep…
#$ agent                          <chr> "NULL", "NULL", "NULL", "304", "240", "240", "NULL", "303", "24…
#$ company                        <chr> "NULL", "NULL", "NULL", "NULL", "NULL", "NULL", "NULL", "NULL",…
#$ days_in_waiting_list           <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
#$ customer_type                  <chr> "Transient", "Transient", "Transient", "Transient", "Transient"…
#$ adr                            <dbl> 0.00, 0.00, 75.00, 75.00, 98.00, 98.00, 107.00, 103.00, 82.00, …
#$ required_car_parking_spaces    <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
#$ total_of_special_requests      <dbl> 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 3, 1, 0, 3, 0, 0, 0, 1, 1, …
#$ reservation_status             <chr> "Check-Out", "Check-Out", "Check-Out", "Check-Out", "Check-Out"…
#$ reservation_status_date        <date> 2015-07-01, 2015-07-01, 2015-07-02, 2015-07-02, 2015-07-03, 20…

#skim_without_charts(bookings_df)
#── Data Summary ────────────────────────
#Values     
#Name                       bookings_df
#Number of rows             119390     
#Number of columns          32         
#_______________________               
#Column type frequency:                
#  character                13         
#Date                     1          
#numeric                  18         
#________________________              
#Group variables            None       

#── Variable type: character ────────────────────────────────────────────────────────────────────────────
#skim_variable        n_missing complete_rate min max empty n_unique whitespace
#1 hotel                        0             1  10  12     0        2          0
#2 arrival_date_month           0             1   3   9     0       12          0
#3 meal                         0             1   2   9     0        5          0
#4 country                      0             1   2   4     0      178          0
#5 market_segment               0             1   6  13     0        8          0
#6 distribution_channel         0             1   3   9     0        5          0
#7 reserved_room_type           0             1   1   1     0       10          0
#8 assigned_room_type           0             1   1   1     0       12          0
#9 deposit_type                 0             1  10  10     0        3          0
#10 agent                        0             1   1   4     0      334          0
#11 company                      0             1   1   4     0      353          0
#12 customer_type                0             1   5  15     0        4          0
#13 reservation_status           0             1   7   9     0        3          0

#── Variable type: Date ─────────────────────────────────────────────────────────────────────────────────
#skim_variable           n_missing complete_rate min        max        median     n_unique
#1 reservation_status_date         0             1 2014-10-17 2017-09-14 2016-08-07      926

#── Variable type: numeric ──────────────────────────────────────────────────────────────────────────────
#skim_variable                  n_missing complete_rate       mean       sd      p0    p25    p50  p75
#1 is_canceled                            0          1       0.370     0.483     0       0      0      1
#2 lead_time                              0          1     104.      107.        0      18     69    160
#3 arrival_date_year                      0          1    2016.        0.707  2015    2016   2016   2017
#4 arrival_date_week_number               0          1      27.2      13.6       1      16     28     38
#5 arrival_date_day_of_month              0          1      15.8       8.78      1       8     16     23
#6 stays_in_weekend_nights                0          1       0.928     0.999     0       0      1      2
#7 stays_in_week_nights                   0          1       2.50      1.91      0       1      2      3
#8 adults                                 0          1       1.86      0.579     0       2      2      2
#9 children                               4          1.00    0.104     0.399     0       0      0      0
#10 babies                                 0          1       0.00795   0.0974    0       0      0      0
#11 is_repeated_guest                      0          1       0.0319    0.176     0       0      0      0
#12 previous_cancellations                 0          1       0.0871    0.844     0       0      0      0
#13 previous_bookings_not_canceled         0          1       0.137     1.50      0       0      0      0
#14 booking_changes                        0          1       0.221     0.652     0       0      0      0
#15 days_in_waiting_list                   0          1       2.32     17.6       0       0      0      0
#16 adr                                    0          1     102.       50.5      -6.38   69.3   94.6  126
#17 required_car_parking_spaces            0          1       0.0625    0.245     0       0      0      0
#18 total_of_special_requests              0          1       0.571     0.793     0       0      0      1
#p100
#1    1
#2  737
#3 2017
#4   53
#5   31
#6   19
#7   50
#8   55
#9   10
#10   10
#11    1
#12   26
#13   72
#14   21
#15  391
#16 5400
#17    8
#18    5

#head(trimmed_df)
## A tibble: 6 × 3
#hotel_type   is_canceled lead_time
#<chr>              <dbl>     <dbl>
#  1 Resort Hotel           0       342
#2 Resort Hotel           0       737
#3 Resort Hotel           0         7
#4 Resort Hotel           0        13
#5 Resort Hotel           0        14
#6 Resort Hotel           0        14

#head(arrival_df)
## A tibble: 6 × 1
#arrival_month_year
#<chr>             
#  1 July 2015         
#2 July 2015         
#3 July 2015         
#4 July 2015         
#5 July 2015         
#6 July 2015    

#str(guests_df)
#tibble [119,390 × 33] (S3: tbl_df/tbl/data.frame)
#$ hotel                         : chr [1:119390] "Resort Hotel" "Resort Hotel" "Resort Hotel" "Resort Hotel" ...
#$ is_canceled                   : num [1:119390] 0 0 0 0 0 0 0 0 1 1 ...
#$ lead_time                     : num [1:119390] 342 737 7 13 14 14 0 9 85 75 ...
#$ arrival_date_year             : num [1:119390] 2015 2015 2015 2015 2015 ...
#$ arrival_date_month            : chr [1:119390] "July" "July" "July" "July" ...
#$ arrival_date_week_number      : num [1:119390] 27 27 27 27 27 27 27 27 27 27 ...
#$ arrival_date_day_of_month     : num [1:119390] 1 1 1 1 1 1 1 1 1 1 ...
#$ stays_in_weekend_nights       : num [1:119390] 0 0 0 0 0 0 0 0 0 0 ...
#$ stays_in_week_nights          : num [1:119390] 0 0 1 1 2 2 2 2 3 3 ...
#$ adults                        : num [1:119390] 2 2 1 1 2 2 2 2 2 2 ...
#$ children                      : num [1:119390] 0 0 0 0 0 0 0 0 0 0 ...
#$ babies                        : num [1:119390] 0 0 0 0 0 0 0 0 0 0 ...
#$ meal                          : chr [1:119390] "BB" "BB" "BB" "BB" ...
#$ country                       : chr [1:119390] "PRT" "PRT" "GBR" "GBR" ...
#$ market_segment                : chr [1:119390] "Direct" "Direct" "Direct" "Corporate" ...
#$ distribution_channel          : chr [1:119390] "Direct" "Direct" "Direct" "Corporate" ...
#$ is_repeated_guest             : num [1:119390] 0 0 0 0 0 0 0 0 0 0 ...
#$ previous_cancellations        : num [1:119390] 0 0 0 0 0 0 0 0 0 0 ...
#$ previous_bookings_not_canceled: num [1:119390] 0 0 0 0 0 0 0 0 0 0 ...
#$ reserved_room_type            : chr [1:119390] "C" "C" "A" "A" ...
#$ assigned_room_type            : chr [1:119390] "C" "C" "C" "A" ...
#$ booking_changes               : num [1:119390] 3 4 0 0 0 0 0 0 0 0 ...
#$ deposit_type                  : chr [1:119390] "No Deposit" "No Deposit" "No Deposit" "No Deposit" ...
#$ agent                         : chr [1:119390] "NULL" "NULL" "NULL" "304" ...
#$ company                       : chr [1:119390] "NULL" "NULL" "NULL" "NULL" ...
#$ days_in_waiting_list          : num [1:119390] 0 0 0 0 0 0 0 0 0 0 ...
#$ customer_type                 : chr [1:119390] "Transient" "Transient" "Transient" "Transient" ...
#$ adr                           : num [1:119390] 0 0 75 75 98 ...
#$ required_car_parking_spaces   : num [1:119390] 0 0 0 0 0 0 0 0 0 0 ...
#$ total_of_special_requests     : num [1:119390] 0 0 0 0 1 1 0 1 1 0 ...
#$ reservation_status            : chr [1:119390] "Check-Out" "Check-Out" "Check-Out" "Check-Out" ...
#$ reservation_status_date       : Date[1:119390], format: "2015-07-01" "2015-07-01" "2015-07-02" ...
#$ guests                        : num [1:119390] 2 2 1 1 2 2 2 2 2 2 ...

#summary_df
## A tibble: 1 × 2
#number_canceled average_lead_time
#<dbl>             <dbl>
#  1           44224              104.